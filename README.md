# checkmk CVE-log4j agent plugin

This agent plugin intergrates the [CVE-2021-44228-Scanner from logpresso](https://github.com/logpresso/CVE-2021-44228-Scanner) with [checkmk](https://checkmk.com/) the system monitoring from [tribe29](https://tribe29.com/).

Included in this package is the scanner for Linux and Windows. You will find the release notes/latest version for the logpresso scanner here [logpresso CVE-2021-44228-Scanner Releases](https://github.com/logpresso/CVE-2021-44228-Scanner/releases).

The scanner (and so the plugin) can discover the following log4j issues

- log4j 1.x
  - CVE-2017-5645
  - CVE-2019-17571
  - CVE-2020-9488
  - CVE-2021-4104
  - CVE-2022-23302
  - CVE-2022-23305
  - CVE-2022-23307
- log4j 2.x
  - CVE-2021-44228
  - CVE-2021-45046
  - CVE-2021-45105
  - CVE-2021-44832
- logback
  - CVE-2021-42550

You will find more information on the [Apache Log4j 2 Security Vulnerabilities](https://logging.apache.org/log4j/2.x/security.html) page (Log4j 1 is no longer supportet, you can find information about Log4j 1 Security Vulnerabilities [here](https://logging.apache.org/log4j/1.2/index.html) on the logging.apache.org web page).

---
### Download
* [cve_2021_44228_log4j.mkp (plugin for CMK 2.0)](https://github.com/thl-cmk/CVE-log4j-check_mk-plugin/raw/master/cve_2021_44228_log4j.mkp)
* [cve_2021_44228_log4j_cmk16.mkp (plugin for CMK 1.6)](https://github.com/thl-cmk/CVE-log4j-check_mk-plugin/raw/master/cve_2021_44228_log4j_cmk16.mkp)

You can find the latest version of this plugin and a lot more checkmk plugins [here](https://thl-cmk.hopto.org/gitlab/checkmk/vendor-independent/cve_2021_44228_log4j)

**Note:** The package for CMK1.6 will not be always on the same level as the version for CMK 2.0. 

**Note**: before you update read the [CHANGELOG](CHANGELOG) please, and have a look at the [Releases](https://github.com/thl-cmk/CVE-log4j-check_mk-plugin/releases), there might be unexpected changes.

---
### Install
* in the checkmk Entrprise/Free edition you can install the plugin via _`Setup > Maintenance > Extension packages`_
* in the checkmk RAW/Community edition you need to copy the package to your checkmk server (via SCP for example), and then - as site user - install the package with `mkp install cve_2021_44228_log4.mkp` on the cli.

---
### How to use
To use this plugin you need to deploy the scanner and the plugin for your destination platform. You can do this via the agent bakery (_`Setup > Agents> Windows, Linux, Solaris, AIX > Agent rules > CVE-2021-44228-log4j`_). Here you can also configure some options for the scanner [(see WATO bakery)](doc/wato-bakery-linux.png "WATO bakery"). If you have created (baked) a new agent package you need to redeploy the agent (automatic update/software deployment)

To use this plugin with the checkmk RAW/Community edition or have a platform that is not supported by the bakery have a look at the [how to information](HOWTO.md "how to"). There you will also find more information around this plugin.

**Note**: only Linux and Windows is implemented for this bakery plugin. If you need this for AIX/Solaris have a look at the [contribution guidelines](CONTRIBUTING.md "Contributing")

---
#### Want to contribute?
Nice ;-) Have a look at the [contribution guidelines](CONTRIBUTING.md "Contributing")

---


<details><summary>Sample output</summary>
 
**Note**: in the service details you will find the raw output from the scanner

![sample output](doc/sample.png?raw=true "sample output")

<details><summary>Sample output details</summary>

 ![(sample details)](doc/sample-details.png "see sample details")

</details>

<details><summary>Sample syslog events in CMK event console</summary>

![(sample syslog events in CMK event console)](doc/sample-syslog.png "sample syslog events in CMK event console")

</details>

<details><summary>Sample inventory summary</summary>

![(sample inventory summary)](doc/sample-inventory.png "sample inventory summary")

</details>


<details><summary>Sample inventory report</summary>

![(sample inventory report)](doc/sample-inventory-report.png "sample inventory report")

</details>

</details>

<details><summary>WATO options</summary>


<details><summary>WATO check plugin</summary>

![WATO check plugin](doc/wato.png "WATO check plugin")
</details>

<details><summary>WATO bakery Linux</summary>

![WATO bakery Linux](doc/wato-bakery-linux.png "WATO bakery Linux")

</details>

<details><summary>WATO bakery Windows</summary>

![WATO bakery Windows](doc/wato-bakery-windows.png "WATO Windows")

</details>

<details><summary>WATO inventory</summary>

![WATO inventory](doc/wato-inventory.png "WATO inventory")

</details>
</details>
